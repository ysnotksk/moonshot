/**
 * Moonshot CSS Framework - Flow Component (SCSS)
 * Step-by-step process/flow visualization with numbered steps and connector lines
 */

@use '../abstracts' as *;

// ========================================
// BASE FLOW
// ========================================

.ms-flow {
  display: grid;
  grid-template-columns: repeat(var(--ms-flow-cols, 4), 1fr);
  gap: space(6);
  counter-reset: flow-step;

  @include breakpoint-down('md') {
    grid-template-columns: 1fr;
    gap: space(4);
  }

  // ========================================
  // FLOW STEP
  // ========================================

  &__step {
    position: relative;
    text-align: center;
    counter-increment: flow-step;

    // Connector line (horizontal on desktop, vertical on mobile)
    &::after {
      content: '';
      position: absolute;
      top: calc(space(8) / 2);
      right: calc(-1 * space(6) / 2);
      width: space(6);
      height: 2px;
      background: var(--ms-gray-300);

      @include breakpoint-down('md') {
        top: auto;
        right: auto;
        bottom: calc(-1 * space(4) / 2);
        left: calc(space(8) / 2);
        width: 2px;
        height: space(4);
      }
    }

    // Hide connector on last item
    &:last-child::after {
      display: none;
    }
  }

  // ========================================
  // FLOW ELEMENTS
  // ========================================

  &__number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: space(8);
    height: space(8);
    margin: 0 auto space(4);
    border-radius: 50%;
    background: var(--ms-brand-primary);
    color: #ffffff;
    font-size: font-size('lg');
    font-weight: 700;
    line-height: 1;

    // Auto-number when content is empty
    &:empty::before {
      content: counter(flow-step);
    }
  }

  &__title {
    @include heading-base;

    margin-bottom: space(2);
    font-size: font-size('lg');
  }

  &__description {
    @include body-text;

    color: var(--ms-text-secondary);
    font-size: font-size('sm');
  }

  // ========================================
  // COLUMN MODIFIERS
  // ========================================

  &--3 {
    --ms-flow-cols: 3;
  }

  &--4 {
    --ms-flow-cols: 4;
  }

  &--5 {
    --ms-flow-cols: 5;
  }

  // ========================================
  // VARIANT: VERTICAL
  // ========================================

  &--vertical {
    grid-template-columns: 1fr;
    gap: space(6);
    max-width: 600px;

    .ms-flow__step {
      display: grid;
      grid-template-columns: space(8) 1fr;
      gap: space(4);
      text-align: left;

      &::after {
        top: space(8);
        right: auto;
        bottom: 0;
        left: calc(space(8) / 2);
        width: 2px;
        height: calc(100% - space(8));
      }

      &:last-child::after {
        display: none;
      }
    }

    .ms-flow__number {
      margin: 0;
      grid-row: 1 / -1;
    }

    .ms-flow__content {
      padding-top: space(1);
    }
  }

  // ========================================
  // SHARED ELEMENTS: MEDIA & CARD
  // ========================================

  &__media {
    border-radius: radius('lg');
    overflow: hidden;
    box-shadow: var(--ms-shadow-md);

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  &__card {
    border: 1px solid var(--ms-border-light);
    border-radius: radius('lg');
    padding: space(6);
    background: var(--ms-bg-primary);
    box-shadow: var(--ms-shadow-sm);
  }

  // ========================================
  // VARIANT: TIMELINE (zigzag)
  // ========================================

  &--timeline {
    grid-template-columns: 1fr;
    max-width: 800px;
    gap: space(12);
    position: relative;
    padding: space(6) 0;

    // Centered vertical line â€” clipped to number range
    &::before {
      content: '';
      position: absolute;
      left: 50%;
      top: space(10);
      bottom: space(10);
      width: 2px;
      background: var(--ms-gray-300);
      transform: translateX(-50%);
    }

    .ms-flow__step {
      display: grid;
      grid-template-columns: 1fr space(16) 1fr;
      gap: space(6);
      align-items: start;
      text-align: left;

      // Suppress per-step connector
      &::after {
        display: none;
      }

      // Even steps: swap media and card sides
      &:nth-child(even) {
        .ms-flow__media {
          order: 3;
        }

        .ms-flow__card {
          order: 1;
        }
      }
    }

    .ms-flow__number {
      // Large decorative number with circular background
      order: 2;
      width: space(12);
      height: space(12);
      background: var(--ms-bg-primary);
      color: var(--ms-brand-primary);
      border: 2px solid var(--ms-gray-200);
      border-radius: 50%;
      font-size: font-size('2xl');
      font-weight: 700;
      margin: 0;
      padding: 0;
      position: relative;
      z-index: 1;
      justify-self: center;
      box-shadow: var(--ms-shadow-sm);
    }

    .ms-flow__media {
      order: 1;
      aspect-ratio: 4 / 3;
    }

    .ms-flow__card {
      order: 3;
    }

    // Mobile: single column stack
    @include breakpoint-down('md') {
      gap: space(8);
      padding: 0;

      &::before {
        display: none;
      }

      .ms-flow__step {
        grid-template-columns: 1fr;
        gap: space(4);
      }

      .ms-flow__number {
        width: space(10);
        height: space(10);
        font-size: font-size('lg');
        justify-self: start;
      }

      .ms-flow__media {
        order: 1;
      }

      .ms-flow__card {
        order: 2;
      }

      .ms-flow__step:nth-child(even) {
        .ms-flow__media {
          order: 1;
        }

        .ms-flow__card {
          order: 2;
        }
      }
    }
  }

  // ========================================
  // VARIANT: BRAND LINE
  // ========================================

  &--brand-line {
    .ms-flow__step::after {
      background: var(--ms-brand-primary);
      opacity: 0.3;
    }
  }

  // ========================================
  // MODIFIER: DASHED LINES
  // ========================================

  &--dashed {
    // For timeline variant (::before on parent)
    &.ms-flow--timeline::before {
      background: repeating-linear-gradient(
        to bottom,
        var(--ms-gray-300) 0,
        var(--ms-gray-300) 6px,
        transparent 6px,
        transparent 12px
      );
    }

    // For default/vertical (::after on steps)
    .ms-flow__step::after {
      background: repeating-linear-gradient(
        to right,
        var(--ms-gray-300) 0,
        var(--ms-gray-300) 6px,
        transparent 6px,
        transparent 12px
      );
    }
  }
}
